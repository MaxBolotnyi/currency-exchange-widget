(this["webpackJsonpcurrency-exchange"]=this["webpackJsonpcurrency-exchange"]||[]).push([[0],{78:function(e,n,t){},79:function(e,n,t){},89:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),o=t(10),r=t.n(o),u=(t(78),t(79),t(13)),i=t(132),s=t(133),l=t(134),d=t(4),b=t(19),m=t(20),f=t(57),v=t(18),h="USD",j=Object(f.a)({reducerPath:"conversion",baseQuery:Object(v.d)({baseUrl:"https://api.exchangerate.host/"}),endpoints:function(e){return{getConversionRates:e.query({query:function(e){var n=e.amount,t=e.from,c=e.to;return"convert?from=".concat(t,"&to=").concat(c,"&amount=").concat(n)},transformResponse:function(e){var n;return{rate:null===e||void 0===e||null===(n=e.info)||void 0===n?void 0:n.rate,amount:null===e||void 0===e?void 0:e.result}}})}}}),p=j.useGetConversionRatesQuery,g=Object(d.d)({name:"acoounts",initialState:{accounts:{}},reducers:{updateAccountBalance:function(e,n){e.accounts[n.payload.id].balance=n.payload.newBalance},setAccounts:function(e,n){n.payload.forEach((function(n){e.accounts[n.id]=n}))},removeAccount:function(e,n){delete e.accounts[n.payload]},clearAccounts:function(e){e.accounts={}}}}),y=g.actions,O=y.updateAccountBalance,x=y.setAccounts,A=(y.removeAccount,y.clearAccounts,Object(m.b)(Object(b.a)({accounts:g.reducer},j.reducerPath,j.reducer))),C=Object(d.a)({reducer:A,middleware:function(e){return e().concat(j.middleware)}}),S=function(){return Object(u.d)()},k=C,w=t(14),I=t(129),N=t(17),D=t(2),R=t(138),E=t(135),B=function(e){return e.replace(/[^0-9.]/g,"")},F=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,t="string"===typeof e?B(e):e;if(!t)return"";var c=Math.pow(10,n);return(Math.round(Number(t)*c)/c).toFixed(n)},T=function(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(1)[0]},P=function(e){var n=e.amount,t=e.precision,c=void 0===t?2:t,a=e.currency,o=B(String(n));if(!o)return"";var r=o.includes("."),u=o.split(".")[1],i=(null===u||void 0===u?void 0:u.length)||0;u&&u.length>c&&(i=c,o=F(o,c));var s=function(e){var n=e.amount,t=e.precision,c=void 0===t?2:t,a=e.currency,o=parseFloat(n);return Number.isNaN(o)?"":new Intl.NumberFormat("en-US",{style:a?"currency":"decimal",currency:a,maximumFractionDigits:c,minimumFractionDigits:c}).format(o)}({amount:o,precision:i,currency:a}),l=r&&!u?".":"";return"".concat(s).concat(l)},V=t(7),M=["accounts","label"],U=a.a.memo((function(e){var n=e.accounts,t=void 0===n?[]:n,c=e.label,a=Object(D.a)(e,M);return Object(V.jsx)(E.a,Object(N.a)(Object(N.a)({},a),{},{label:c,variant:"outlined",select:!0,children:t.map((function(e){var n=P({amount:e.balance.toString(),currency:e.currency}),t="".concat(e.name," - ").concat(n);return Object(V.jsx)(R.a,{value:e.id,children:t},e.id)}))}))})),L=t(139),q=t(127),G=["label","value","currency","onChange","className","precision"],H=a.a.memo((function(e){var n=e.label,t=e.value,c=e.currency,o=void 0===c?h:c,r=e.onChange,u=e.className,i=e.precision,s=void 0===i?2:i,l=Object(D.a)(e,G),d=a.a.useState(""),b=Object(w.a)(d,2),m=b[0],f=b[1],v=a.a.useState(!1),j=Object(w.a)(v,2),p=j[0],g=j[1],y=a.a.useCallback((function(){return g(!0)}),[]);a.a.useEffect((function(){if(!p){var e=String(t)||"",n=F(e,s),c=P({amount:n,precision:s});f(c)}}),[t,s,p]);var O=a.a.useCallback((function(){if(m){var e=F(m),n=P({amount:e,precision:s});f(n),g(!1)}}),[m,s]);return Object(V.jsx)(q.a,{className:u,variant:"outlined",children:Object(V.jsx)(E.a,Object(N.a)(Object(N.a)({},l),{},{label:n,value:m,placeholder:"0.00",onChange:function(e){var n=e.target.value,t=B(n),c=P({amount:n,precision:s});f(c),r&&r(F(t,s))},onBlur:O,onFocus:y,inputProps:{style:{textAlign:"right"}},InputLabelProps:{shrink:!0},InputProps:{startAdornment:Object(V.jsx)(L.a,{"data-testid":"currency-sign",position:"start",children:T(o)})},variant:"outlined"}))})})),J=t(136),Q=t(130),$=Object(Q.a)({root:{visibility:"hidden",width:150,height:30,alignItems:"center",justifyContent:"center",position:"absolute",top:-100,left:"calc(50% - 75px)",transition:"top 0.3s linear"},open:{top:10,visibility:"visible"}}),z=["children","open","onDelayedClose","delay"],K=a.a.memo((function(e){var n=e.children,t=e.open,c=void 0!==t&&t,o=e.onDelayedClose,r=e.delay,u=void 0===r?1600:r,i=Object(D.a)(e,z),s=$();return a.a.useEffect((function(){var e;return c&&(e=setTimeout((function(){o&&o()}),u)),function(){e&&clearTimeout(e)}}),[c,u,o]),Object(V.jsx)(J.a,Object(N.a)(Object(N.a)({},i),{},{className:"".concat(s.root," ").concat(c?s.open:""),variant:"filled",children:n}))})),W=t(137),X=Object(Q.a)((function(e){return Object(W.a)({container:{borderRadius:20,boxShadow:e.shadows[1],width:350,height:400,backgroundColor:"".concat(e.palette.background.paper),display:"flex",position:"relative",flexDirection:"column",justifyContent:"space-evenly",alignItems:"strech",padding:"20px",overflow:"hidden"}})})),Y=a.a.memo((function(e){var n=e.children,t=X();return Object(V.jsx)("div",{className:t.container,children:n})})),Z=t(131),_=t(61),ee=t.n(_),ne=t(41),te=t.n(ne),ce=t(48),ae=Object(Q.a)((function(e){return Object(W.a)({root:{background:"linear-gradient(45deg, ".concat(ee.a[300]," 30%, ").concat(te.a[300]," 90%)"),borderRadius:20,height:40,padding:"0 30px"},disabled:{background:"linear-gradient(45deg, ".concat(ce.a[700]," 30%, ").concat(ce.a[500]," 90%)")},label:{color:e.palette.common.white}})})),oe=["children"],re=a.a.memo((function(e){var n=e.children,t=Object(D.a)(e,oe),c=ae();return Object(V.jsx)(Z.a,Object(N.a)(Object(N.a)({},t),{},{classes:{root:c.root,disabled:c.disabled,label:c.label},children:n}))})),ue=Object(Q.a)({marginRight:{marginRight:20},select:{marginTop:30},row:{marginTop:30,display:"flex",flexDirection:"row"},container:{display:"flex",flex:1,flexDirection:"column",justifyContent:"flex-start"},rateInfo:{margin:20,textAlign:"center"}}),ie=a.a.memo((function(e){var n=e.showToast,t=void 0!==n&&n,c=e.onToastClose,a=e.accounts,o=void 0===a?[]:a,r=e.src,u=e.dest,i=e.isValid,s=void 0!==i&&i,l=e.exchangeRate,d=e.onSumbit,b=ue(),m=+r.balance<+r.amount;return Object(V.jsxs)(Y,{children:[Object(V.jsx)(K,{severity:"success",open:t,onDelayedClose:c,children:"Done!"}),Object(V.jsxs)("div",{className:b.container,children:[Object(V.jsx)(U,{id:"sourceAcc",name:"sourceAcc",accounts:o,value:r.accountId,className:b.select,label:"Source Account",onChange:r.onAccountChange}),Object(V.jsx)(U,{id:"destAcc",name:"destAcc",value:u.accountId,accounts:o,className:b.select,label:"Destination Account",onChange:u.onAccountChange}),Object(V.jsxs)("div",{className:b.row,children:[Object(V.jsx)(H,{id:"srcAmount",name:"srcAmount",error:m,disabled:!r.accountId,helperText:m&&"Not enough money",className:b.marginRight,currency:r.currency,value:r.amount,onChange:r.onValChange}),Object(V.jsx)(H,{id:"destAmount",name:"destAmount",disabled:!u.accountId,currency:u.currency,value:u.amount,onChange:u.onValChange})]})]}),!m&&!!r.accountId&&!!u.accountId&&!!r.currency&&!!u.currency&&!!r.amount&&!!u.amount&&r.currency!==u.currency&&Object(V.jsx)(I.a,{className:b.rateInfo,children:l?"Rate: ".concat(T(r.currency),"1 = ").concat(T(u.currency)).concat(l):"Loading..."}),Object(V.jsx)(re,{disabled:!s,onClick:d,children:"Exchange"})]})})),se=t(42),le=t.n(se),de=t(51),be=[{id:"account-1",name:"Dollars Account",currency:"USD",balance:3e4},{id:"account-2",name:"Euros Account",currency:"EUR",balance:25e3},{id:"account-3",name:"Pounds Account",currency:"GBP",balance:13e3}],me=function(e){var n,t,c,o=e.accounts,r=e.useApiHook,u=S(),i=a.a.useState(""),s=Object(w.a)(i,2),l=s[0],d=s[1],b=a.a.useState(""),m=Object(w.a)(b,2),f=m[0],v=m[1],j=a.a.useState(""),p=Object(w.a)(j,2),g=p[0],y=p[1],x=a.a.useState(""),A=Object(w.a)(x,2),C=A[0],k=A[1],I=a.a.useState("dest"),N=Object(w.a)(I,2),D=N[0],R=N[1],E=a.a.useState(!1),B=Object(w.a)(E,2),T=B[0],P=B[1],V=a.a.useCallback((function(e){return o[e]}),[o]),M=r({amount:g||C||1,from:(null===(n=V(l))||void 0===n?void 0:n.currency)||h,to:(null===(t=V(f))||void 0===t?void 0:t.currency)||h},{skip:!l||!f,pollingInterval:1e4}),U=M.data,L=M.isError,q=M.isSuccess,G=M.refetch;a.a.useEffect((function(){var e=l&&f;e&&g&&!C?R("dest"):e&&C&&!g&&R("src")}),[l,f,C,g,D]),a.a.useEffect((function(){if("src"===D&&C){var e=!!(null===U||void 0===U?void 0:U.rate)&&+C/U.rate;y(e?"".concat(e):g)}else"dest"===D&&g&&k((null===U||void 0===U?void 0:U.amount)?"".concat(U.amount):C)}),[D,U,g,C,f,l]),a.a.useEffect((function(){T&&q&&(u(function(e){var n=e.source,t=e.destination;return function(){var e=Object(de.a)(le.a.mark((function e(c,a){var o,r,u,i,s,l;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a(),r=o.accounts,u=r.accounts[n.id],i=r.accounts[t.id],u&&i){e.next=5;break}return e.abrupt("return");case 5:if(!(u.balance<n.amount)){e.next=7;break}return e.abrupt("return");case 7:s=u.balance-n.amount,l=i.balance+t.amount,c(O({id:u.id,newBalance:+F(s)})),c(O({id:i.id,newBalance:+F(l)}));case 11:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()}({source:{id:l,amount:Number(g)},destination:{id:f,amount:Number(C)}})),y(""),k(""),P(!1))}),[T,U,l,g,f,C,u,q]);var H=l&&+g>(null===(c=V(l))||void 0===c?void 0:c.balance),J=[l,f,g,C,!H,l!==f,!L].every((function(e){return!!e}));return{sourceAcc:l,sourceAmount:g,destAcc:f,destAmount:C,setSourceAcc:d,setDestAcc:v,setSrcAmount:function(e){y(e),e||k(""),f&&R("dest")},setDestAmount:function(e){k(e),e||y(""),l&&R("src")},isValid:J,onSubmit:function(){G(),P(!0)},exchangeRate:q&&(null===U||void 0===U?void 0:U.rate),data:U}},fe=function(e){return e.accounts},ve=function(){var e=Object(u.e)(fe),n=S();a.a.useEffect((function(){n(function(){var e=Object(de.a)(le.a.mark((function e(n){return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(x(be));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}),[n]);var t=a.a.useMemo((function(){return Object.values(e.accounts)}),[e]),c=a.a.useCallback((function(n){return e.accounts[n]}),[e]);return{state:e,list:t,getById:c}},he=a.a.memo((function(){var e,n,t,c=a.a.useState(!1),o=Object(w.a)(c,2),r=o[0],u=o[1],i=ve(),s=i.state,l=i.list,d=i.getById,b=me({accounts:s.accounts,useApiHook:p}),m=b.sourceAcc,f=b.sourceAmount,v=b.destAcc,h=b.destAmount,j=b.setSourceAcc,g=b.setDestAcc,y=b.setSrcAmount,O=b.setDestAmount,x=b.isValid,A=b.exchangeRate,C=b.onSubmit,S=a.a.useCallback((function(){u(!1)}),[]);return Object(V.jsx)(ie,{accounts:l,isValid:x,showToast:r,onToastClose:S,onSumbit:function(){C(),u(!0)},exchangeRate:A,src:{accountId:m,currency:null===(e=d(m))||void 0===e?void 0:e.currency,amount:f,balance:null===(n=d(m))||void 0===n?void 0:n.balance,onAccountChange:function(e){j(e.target.value)},onValChange:y},dest:{accountId:v,currency:null===(t=d(v))||void 0===t?void 0:t.currency,amount:h,onAccountChange:function(e){g(e.target.value)},onValChange:O}})})),je=t(62);var pe=function(){var e=Object(i.a)("(prefers-color-scheme: dark)"),n=a.a.useMemo((function(){return function(e){return Object(je.a)({palette:{type:e?"dark":"light",primary:{main:te.a[400]}},overrides:{MuiOutlinedInput:{root:{"&:hover $notchedOutline":{borderColor:te.a[400]}}},MuiSelect:{select:{"&:focus":{backgroundColor:"transparent"}}}}})}(e)}),[e]);return Object(V.jsx)(u.a,{store:k,children:Object(V.jsx)(s.a,{theme:n,children:Object(V.jsx)(l.a,{children:Object(V.jsx)("div",{"data-testid":"app-test-id",className:"App",style:{backgroundColor:n.palette.background.default},children:Object(V.jsx)(he,{})})})})})},ge=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,140)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,o=n.getLCP,r=n.getTTFB;t(e),c(e),a(e),o(e),r(e)}))};r.a.render(Object(V.jsx)(a.a.StrictMode,{children:Object(V.jsx)(pe,{})}),document.getElementById("root")),ge()}},[[89,1,2]]]);
//# sourceMappingURL=main.274d411e.chunk.js.map