(this["webpackJsonpcurrency-exchange"]=this["webpackJsonpcurrency-exchange"]||[]).push([[0],{79:function(e,n,t){},80:function(e,n,t){},90:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),o=t(10),r=t.n(o),u=(t(79),t(80),t(14)),i=t(4),s=t(19),l=t(20),d=t(57),b=t(18),m=Object(d.a)({reducerPath:"conversion",baseQuery:Object(b.d)({baseUrl:"https://api.exchangerate.host/"}),endpoints:function(e){return{getConversionRates:e.query({query:function(e){var n=e.amount,t=e.from,c=e.to;return"convert?from=".concat(t,"&to=").concat(c,"&amount=").concat(n)},transformResponse:function(e){var n;return{rate:null===e||void 0===e||null===(n=e.info)||void 0===n?void 0:n.rate,amount:null===e||void 0===e?void 0:e.result}}})}}}),f=m.useGetConversionRatesQuery,v=t(58),h=Object(i.d)({name:"acoounts",initialState:{accounts:{}},reducers:{updateAccountBalance:function(e,n){e.accounts[n.payload.id].balance=n.payload.newBalance},setAccounts:function(e,n){var t,c=Object(v.a)(n.payload);try{for(c.s();!(t=c.n()).done;){var a=t.value;e.accounts[a.id]=a}}catch(o){c.e(o)}finally{c.f()}},removeAccount:function(e,n){delete e.accounts[n.payload]},clearAccounts:function(e){e.accounts={}}}}),j=h.actions,p=j.updateAccountBalance,g=j.setAccounts,y=(j.removeAccount,j.clearAccounts,Object(l.b)(Object(s.a)({accounts:h.reducer},m.reducerPath,m.reducer))),O=Object(i.a)({reducer:y,middleware:function(e){return e().concat(m.middleware)}}),x=function(){return Object(u.d)()},A=O,C=t(133),S=t(134),k=t(135),w=t(13),D=t(130),I=t(17),N=t(2),F=t(139),R=t(136),E=function(e){return e.replace(/[^0-9.]/g,"")},B=function(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(1)[0]},T=function(e){var n=e.amount,t=e.precision,c=void 0===t?2:t,a=e.currency,o=E(String(n));if(!o)return"";var r=o.includes("."),u=o.split("."),i=Object(w.a)(u,2),s=i[0],l=i[1],d=void 0===l?"":l;d&&d.length>c&&(d=d.slice(0,c),o="".concat(s,".").concat(d.slice(0,c)));var b=function(e){var n=e.amount,t=e.precision,c=void 0===t?2:t,a=e.currency,o=parseFloat(n);return o?new Intl.NumberFormat("en-US",{style:a?"currency":"decimal",currency:a,maximumFractionDigits:c,minimumFractionDigits:c}).format(o):""}({amount:o,precision:d.length,currency:a}),m=r&&!d?".":"";return"".concat(b).concat(m)},P=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!parseFloat(e))return e;var t=e.split("."),c=Object(w.a)(t,2),a=c[0],o=c[1],r=a||"0",u="0".repeat(n);return o?"".concat(r,".").concat(o.padEnd(n,"0")):"".concat(r,".").concat(u)},U=t(7),V=["accounts","label"],M=a.a.memo((function(e){var n=e.accounts,t=void 0===n?[]:n,c=e.label,a=Object(N.a)(e,V);return Object(U.jsx)(R.a,Object(I.a)(Object(I.a)({},a),{},{label:c,variant:"outlined",select:!0,children:t.map((function(e){var n=T({amount:e.balance.toString(),precision:2,currency:e.currency}),t="".concat(e.name," - ").concat(n);return Object(U.jsx)(F.a,{value:e.id,children:t},e.id)}))}))})),L=t(140),q=t(128),G=["label","value","currency","onChange","className","precision"],H=a.a.memo((function(e){var n=e.label,t=e.value,c=e.currency,o=void 0===c?"USD":c,r=e.onChange,u=e.className,i=e.precision,s=void 0===i?2:i,l=Object(N.a)(e,G),d=a.a.useState(""),b=Object(w.a)(d,2),m=b[0],f=b[1],v=a.a.useState(!1),h=Object(w.a)(v,2),j=h[0],p=h[1],g=a.a.useCallback((function(){return p(!0)}),[]);a.a.useEffect((function(){if(!j){var e=String(t)?String(t):"",n=T({amount:e,precision:s});j||(n=P(n,s)),f(n)}}),[t,s,j]);var y=a.a.useCallback((function(){if(m){var e=P(m);f(e),p(!1)}}),[m]);return Object(U.jsx)(q.a,{className:u,variant:"outlined",children:Object(U.jsx)(R.a,Object(I.a)(Object(I.a)({},l),{},{label:n,value:m,placeholder:"0.00",onChange:function(e){var n=e.target.value,t=E(n),c=T({amount:n,precision:s});f(c),r&&r({value:Number(t).toFixed(s),originalEvent:e})},onBlur:y,onFocus:g,InputLabelProps:{shrink:!0},inputProps:{style:{textAlign:"right"}},InputProps:{startAdornment:Object(U.jsx)(L.a,{"data-testid":"currency-sign",position:"start",children:B(o)})},variant:"outlined"}))})})),J=t(137),Q=t(131),$=Object(Q.a)({root:{visibility:"hidden",width:150,height:30,alignItems:"center",justifyContent:"center",position:"absolute",top:-100,left:"calc(50% - 75px)",transition:"top 0.3s linear"},open:{top:10,visibility:"visible"}}),z=["children","open","onDelayedClose","delay"],K=a.a.memo((function(e){var n=e.children,t=e.open,c=void 0!==t&&t,o=e.onDelayedClose,r=e.delay,u=void 0===r?1600:r,i=Object(N.a)(e,z),s=$();return a.a.useEffect((function(){var e;return c&&(e=setTimeout((function(){o&&o()}),u)),function(){e&&clearTimeout(e)}}),[c,u,o]),Object(U.jsx)(J.a,Object(I.a)(Object(I.a)({},i),{},{className:"".concat(s.root," ").concat(c?s.open:""),variant:"filled",children:n}))})),W=t(138),X=Object(Q.a)((function(e){return Object(W.a)({container:{borderRadius:20,boxShadow:e.shadows[1],width:350,height:400,backgroundColor:"".concat(e.palette.background.paper),display:"flex",position:"relative",flexDirection:"column",justifyContent:"space-evenly",alignItems:"strech",padding:"20px",overflow:"hidden"}})})),Y=a.a.memo((function(e){var n=e.children,t=X();return Object(U.jsx)("div",{className:t.container,children:n})})),Z=t(132),_=t(62),ee=t.n(_),ne=t(42),te=t.n(ne),ce=t(48),ae=Object(Q.a)((function(e){return Object(W.a)({root:{background:"linear-gradient(45deg, ".concat(ee.a[300]," 30%, ").concat(te.a[300]," 90%)"),borderRadius:20,height:40,padding:"0 30px"},disabled:{background:"linear-gradient(45deg, ".concat(ce.a[700]," 30%, ").concat(ce.a[500]," 90%)")},label:{color:e.palette.common.white}})})),oe=["children"],re=a.a.memo((function(e){var n=e.children,t=Object(N.a)(e,oe),c=ae();return Object(U.jsx)(Z.a,Object(I.a)(Object(I.a)({},t),{},{classes:{root:c.root,disabled:c.disabled,label:c.label},children:n}))})),ue=Object(Q.a)({marginRight:{marginRight:20},select:{marginTop:30},row:{marginTop:30,display:"flex",flexDirection:"row"},container:{display:"flex",flex:1,flexDirection:"column",justifyContent:"flex-start"},rateInfo:{margin:20,textAlign:"center"}}),ie=a.a.memo((function(e){var n=e.showToast,t=void 0!==n&&n,c=e.onToastClose,a=e.accounts,o=void 0===a?[]:a,r=e.src,u=e.dest,i=e.isValid,s=void 0!==i&&i,l=e.exchangeRate,d=e.onSumbit,b=ue(),m=+r.balance<+r.amount;return Object(U.jsxs)(Y,{children:[Object(U.jsx)(K,{severity:"success",open:t,onDelayedClose:c,children:"Done!"}),Object(U.jsxs)("div",{className:b.container,children:[Object(U.jsx)(M,{id:"sourceAcc",name:"sourceAcc",accounts:o,value:r.accountId,className:b.select,label:"Source Account",onChange:r.onAccountChange}),Object(U.jsx)(M,{id:"destAcc",name:"destAcc",value:u.accountId,accounts:o,className:b.select,label:"Destination Account",onChange:u.onAccountChange}),Object(U.jsxs)("div",{className:b.row,children:[Object(U.jsx)(H,{id:"srcAmount",name:"srcAmount",error:m,helperText:m&&"Not enough money",className:b.marginRight,currency:r.currency,value:r.amount,onChange:r.onValChange}),Object(U.jsx)(H,{id:"destAmount",name:"destAmount",currency:u.currency,value:u.amount,onChange:u.onValChange})]})]}),!m&&!!r.accountId&&!!u.accountId&&!!r.currency&&!!u.currency&&!!r.amount&&!!u.amount&&r.currency!==u.currency&&Object(U.jsx)(D.a,{className:b.rateInfo,children:l?"Rate: ".concat(B(r.currency),"1 = ").concat(B(u.currency)).concat(l):"Loading..."}),Object(U.jsx)(re,{disabled:!s,onClick:d,children:"Exchange"})]})})),se=t(43),le=t.n(se),de=t(51),be=[{id:"account-1",name:"Dollars Account",currency:"USD",balance:3e4},{id:"account-2",name:"Euros Account",currency:"EUR",balance:25e3},{id:"account-3",name:"Pounds Account",currency:"GBP",balance:13e3}],me=function(e){var n,t,c,o=e.accounts,r=e.useApiHook,u=x(),i=a.a.useState(""),s=Object(w.a)(i,2),l=s[0],d=s[1],b=a.a.useState(""),m=Object(w.a)(b,2),f=m[0],v=m[1],h=a.a.useState(""),j=Object(w.a)(h,2),g=j[0],y=j[1],O=a.a.useState(""),A=Object(w.a)(O,2),C=A[0],S=A[1],k=a.a.useState("dest"),D=Object(w.a)(k,2),I=D[0],N=D[1],F=a.a.useState(!1),R=Object(w.a)(F,2),E=R[0],B=R[1],T=a.a.useCallback((function(e){return o[e]}),[o]),P=r({amount:g||C||1,from:(null===(n=T(l))||void 0===n?void 0:n.currency)||"USD",to:(null===(t=T(f))||void 0===t?void 0:t.currency)||"USD"},{skip:!l||!f,pollingInterval:1e4}),U=P.data,V=P.isError,M=P.isSuccess,L=P.refetch;a.a.useEffect((function(){var e=l&&f;e&&g&&!C?N("dest"):e&&C&&!g&&N("src")}),[l,f,C,g,I]),a.a.useEffect((function(){if("src"===I&&C){var e=!!(null===U||void 0===U?void 0:U.rate)&&+C/U.rate;y(e?"".concat(e):"")}else"dest"===I&&g&&S((null===U||void 0===U?void 0:U.amount)?"".concat(U.amount):"")}),[I,U,g,C]),a.a.useEffect((function(){E&&M&&(u(function(e){var n=e.source,t=e.destination;return function(){var e=Object(de.a)(le.a.mark((function e(c,a){var o,r,u,i,s,l;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a(),r=o.accounts,u=r.accounts[n.id],i=r.accounts[t.id],u&&i){e.next=6;break}return console.error("Accounts: wrong id passed either to destionation or source! (accounts.ts:34)"),e.abrupt("return");case 6:if(!(u.balance<n.amount)){e.next=9;break}return console.error("Accounts: the amount of the transaction is bigger than the source account balance (accounts.ts:39)"),e.abrupt("return");case 9:s=u.balance-n.amount,l=i.balance+t.amount,c(p({id:u.id,newBalance:+s.toFixed(2)})),c(p({id:i.id,newBalance:+l.toFixed(2)}));case 13:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()}({source:{id:l,amount:Number(g)},destination:{id:f,amount:Number(C)}})),y(""),S(""),B(!1))}),[E,U,l,g,f,C,u,M]);var q=l&&+g>(null===(c=T(l))||void 0===c?void 0:c.balance),G=[l,f,g,C,!q,l!==f,!V].every((function(e){return!!e}));return{sourceAcc:l,sourceAmount:g,destAcc:f,destAmount:C,setSourceAcc:d,setDestAcc:v,setSrcAmount:function(e){y(e),e||S(""),f&&N("dest")},setDestAmount:function(e){S(e),e||y(""),l&&N("src")},isValid:G,onSubmit:function(){L(),B(!0)},exchangeRate:M&&(null===U||void 0===U?void 0:U.rate),data:U}},fe=function(e){return e.accounts},ve=function(){var e=Object(u.e)(fe),n=x();a.a.useEffect((function(){n(function(){var e=Object(de.a)(le.a.mark((function e(n){return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(g(be));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}),[n]);var t=a.a.useMemo((function(){return Object.values(e.accounts)}),[e]),c=a.a.useCallback((function(n){return e.accounts[n]}),[e]);return{state:e.accounts,list:t,getById:c}},he=a.a.memo((function(){var e,n,t,c=a.a.useState(!1),o=Object(w.a)(c,2),r=o[0],u=o[1],i=ve(),s=i.state,l=i.list,d=i.getById,b=me({accounts:s,useApiHook:f}),m=b.sourceAcc,v=b.sourceAmount,h=b.destAcc,j=b.destAmount,p=b.setSourceAcc,g=b.setDestAcc,y=b.setSrcAmount,O=b.setDestAmount,x=b.isValid,A=b.exchangeRate,C=b.onSubmit,S=a.a.useCallback((function(){u(!1)}),[]);return Object(U.jsx)(ie,{accounts:l,isValid:x,showToast:r,onToastClose:S,onSumbit:function(){C(),u(!0)},exchangeRate:A,src:{accountId:m,currency:null===(e=d(m))||void 0===e?void 0:e.currency,amount:v,balance:null===(n=d(m))||void 0===n?void 0:n.balance,onAccountChange:function(e){p(e.target.value)},onValChange:function(e){y(e.value?String(e.value):"")}},dest:{accountId:h,currency:null===(t=d(h))||void 0===t?void 0:t.currency,amount:j,onAccountChange:function(e){g(e.target.value)},onValChange:function(e){O(e.value?String(e.value):"")}}})})),je=t(63);var pe=function(){var e=Object(C.a)("(prefers-color-scheme: dark)"),n=a.a.useMemo((function(){return function(e){return Object(je.a)({palette:{type:e?"dark":"light",primary:{main:te.a[400]}},overrides:{MuiOutlinedInput:{root:{"&:hover $notchedOutline":{borderColor:te.a[400]}}},MuiSelect:{select:{"&:focus":{backgroundColor:"transparent"}}}}})}(e)}),[e]);return Object(U.jsx)(u.a,{store:A,children:Object(U.jsx)(S.a,{theme:n,children:Object(U.jsx)(k.a,{children:Object(U.jsx)("div",{"data-testid":"app-test-id",className:"App",style:{backgroundColor:n.palette.background.default},children:Object(U.jsx)(he,{})})})})})},ge=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,141)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,o=n.getLCP,r=n.getTTFB;t(e),c(e),a(e),o(e),r(e)}))};r.a.render(Object(U.jsx)(a.a.StrictMode,{children:Object(U.jsx)(pe,{})}),document.getElementById("root")),ge()}},[[90,1,2]]]);
//# sourceMappingURL=main.3a118c71.chunk.js.map